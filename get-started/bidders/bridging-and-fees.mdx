
## Bridging 

The following diagram illustrates the flow of a cross chain transfer from an account on L1, to a recipient account on the mev-commit chain. 

![Image Not Found](bridge_flow.png)

To bridge from L1 to the mev-commit chain, a user EOA first calls the `InitiateTransfer` function on the L1 gateway contract. This function accepts two parameters, a recipient account to receive funds on the counterparty chain, and an amount to transfer. The user must send (lock) the appropriate amount of ether in the L1 gateway contract as a part of the transaction that calls this function.

During the `InitiateTransfer` transaction, an event is emitted from L1. The relayer continuously monitors for these L1 events from finalized blocks. Once the L1 event is observed by the relayer, it calls the `FinalizeTransfer` function on the bridge gateway contract residing on the mev-commit chain. This transaction mints native ether to the recipient EOA, with an appropriate amount of wei.

To bridge ether from the mev-commit chain back to L1, a user follows the same pattern as described above, as the relayer monitors both chains for transfer events. 

Note the destination gateway contract enforces a flat fee on the destination address. This is a constant fee paid to the relayer during the transfer finalization transaction. It currently serves as a simple 1 wei placeholder. In production this fee must be greater on average than the gas cost of transfer finalization transactions sent from the relayer.

### Bridging quick-start 

See the following instructions to use the bridge cli tool. A frontend compatible with metamask will be available soon.

To test out the bridge cli with a one-liner using a pre-funded account (as of writing) on Holesky, try the following command:

```bash
curl -s https://raw.githubusercontent.com/primevprotocol/scripts/bridge/bridge.sh | bash
```
Otherwise see further instructions to bridge using your own Holesky account.

First build the user cli for your machine from this directory:

```bash
make user_cli
```

Or use a pre-built binary from the `releases` tab in [mev-commit-bridge](https://github.com/primevprotocol/mev-commit-bridge/releases).

Set proper environment variables for a cross-chain transfer, example below:

```bash 
export PRIVATE_KEY="0xe82a054e06f89598485134b4f2ce8a612ce7f7f7e14e650f9f20b30efddd0e57"
export LOG_LEVEL="debug"
export L1_RPC_URL="https://ethereum-holesky.publicnode.com"
export SETTLEMENT_RPC_URL="https://chainrpc.testnet.mev-commit.xyz"
export L1_CHAIN_ID="17000"
export SETTLEMENT_CHAIN_ID="17864"
export L1_CONTRACT_ADDR="0xceff0a364f63f621ff6a8b5ce56569ec6f3c6220"
export SETTLEMENT_CONTRACT_ADDR="0xf60f8e762a3fe90fd4d8c005872b6f6e12eda8ca"
```

Note the above contract addresses are correct for the current deployment of the mev-commit testnet. Constant ENS addresses will be available soon.

To bridge ether from Holesky to the mev-commit chain, use:

```bash
./bin/user_cli bridge-to-settlement --amount $AMOUNT_IN_WEI --dest-addr $DEST_ADDR
```

Where `PRIVATE_KEY` corresponds to an account that's funded on Holesky. 

To bridge ether back to Holesky from the mev-commit chain, use:

```bash
./bin/user_cli bridge-to-l1 --amount $AMOUNT_IN_WEI --dest-addr $DEST_ADDR
```
Where `PRIVATE_KEY` corresponds to an account that's funded on the mev-commit chain.
